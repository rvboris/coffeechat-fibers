(function(a){function k(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{window.localStorage&&(c=window.localStorage,h="localStorage")}catch(e){}else if("globalStorage"in window)try{window.globalStorage&&(c=window.globalStorage[window.location.hostname],h="globalStorage")}catch(f){}else{d=document.createElement("link");if(!d.addBehavior){d=null;return}d.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(d),d.load("jStorage");var g="{}";try{g=d.getAttribute("jStorage")}catch(i){}c.jStorage=g,h="userDataBehavior"}l(),o()}function l(){if(c.jStorage)try{b=g(String(c.jStorage))}catch(a){c.jStorage="{}"}else c.jStorage="{}";e=c.jStorage?String(c.jStorage).length:0}function m(){try{c.jStorage=f(b),d&&(d.setAttribute("jStorage",c.jStorage),d.save("jStorage")),e=c.jStorage?String(c.jStorage).length:0}catch(a){}}function n(a){if(!a||typeof a!="string"&&typeof a!="number")throw new TypeError("Key name must be string or numeric");if(a=="__jstorage_meta")throw new TypeError("Reserved key name");return!0}function o(){var a,c,d,e=Infinity,f=!1;clearTimeout(i);if(!b.__jstorage_meta||typeof b.__jstorage_meta.TTL!="object")return;a=+(new Date),d=b.__jstorage_meta.TTL;for(c in d)d.hasOwnProperty(c)&&(d[c]<=a?(delete d[c],delete b[c],f=!0):d[c]<e&&(e=d[c]));e!=Infinity&&(i=setTimeout(o,e-a)),f&&m()}if(!a||!(a.toJSON||Object.toJSON||window.JSON))throw new Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!");var b={},c={jStorage:"{}"},d=null,e=0,f=a.toJSON||Object.toJSON||window.JSON&&(JSON.encode||JSON.stringify),g=a.evalJSON||window.JSON&&(JSON.decode||JSON.parse)||function(a){return String(a).evalJSON()},h=!1,i,j={isXML:function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(c){}}return!1},decode:function(a){var b="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b},c;return b?(c=b.call("DOMParser"in window&&new DOMParser||window,a,"text/xml"),this.isXML(c)?c:!1):!1}};a.jStorage={version:"0.1.6.1",set:function(a,c){return n(a),j.isXML(c)?c={_is_xml:!0,xml:j.encode(c)}:typeof c=="function"?c=null:c&&typeof c=="object"&&(c=g(f(c))),b[a]=c,m(),c},get:function(a,c){return n(a),a in b?b[a]&&typeof b[a]=="object"&&b[a]._is_xml&&b[a]._is_xml?j.decode(b[a].xml):b[a]:typeof c=="undefined"?null:c},deleteKey:function(a){return n(a),a in b?(delete b[a],b.__jstorage_meta&&typeof b.__jstorage_meta.TTL=="object"&&a in b.__jstorage_meta.TTL&&delete b.__jstorage_meta.TTL[a],m(),!0):!1},setTTL:function(a,c){var d=+(new Date);return n(a),c=Number(c)||0,a in b?(b.__jstorage_meta||(b.__jstorage_meta={}),b.__jstorage_meta.TTL||(b.__jstorage_meta.TTL={}),c>0?b.__jstorage_meta.TTL[a]=d+c:delete b.__jstorage_meta.TTL[a],m(),o(),!0):!1},flush:function(){return b={},m(),!0},storageObj:function(){function a(){}return a.prototype=b,new a},index:function(){var a=[],c;for(c in b)b.hasOwnProperty(c)&&c!="__jstorage_meta"&&a.push(c);return a},storageSize:function(){return e},currentBackend:function(){return h},storageAvailable:function(){return!!h},reInit:function(){var a,b;if(d&&d.addBehavior){a=document.createElement("link"),d.parentNode.replaceChild(a,d),d=a,d.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(d),d.load("jStorage"),b="{}";try{b=d.getAttribute("jStorage")}catch(e){}c.jStorage=b,h="userDataBehavior"}l()}},k()})(window.jQuery||window.$);